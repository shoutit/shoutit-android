machine:
   java:
       version: oraclejdk8

dependencies:
    override:
        - echo y | android update sdk --no-ui --all --filter tools,platform-tools,android-23,extra-google-m2repository,extra-google-google_play_services,extra-android-support
        - echo y | android update sdk --no-ui --all --filter build-tools-23.0.1,build-tools-23.0.3

checkout:
    post:
        - git submodule init
        - git submodule update

test:
    pre:
        - python tools/download.py --token P8uXtUgTeNDYEIvw5gXUWjDM --key-version agxzfmF1dG8tY2xvc2VyGAsSC1Byb2plY3RLZXlzGICAgKDI0JMKDA

    override:
        - (./gradlew --stacktrace --project-prop versionSuffix="${CIRCLE_BUILD_NUM}" clean build -PpreDexEnable=false -Dorg.gradle.jvmargs="-Xms2560m -Xmx2560m"):
            timeout: 1800

    post:
        - ./gradlew :app:signingReport

deployment:
  master:
    branch: master
    commands:
      - "./upload.sh"
      - python tools/upload.py --token P8uXtUgTeNDYEIvw5gXUWjDM --build-name "$(git rev-parse --short HEAD)-$(git rev-parse --abbrev-ref HEAD)" app/build/outputs/apk/

  develop:
    branch: develop
    commands:
      - "./upload.sh"
      - python tools/upload.py --token P8uXtUgTeNDYEIvw5gXUWjDM --build-name "$(git rev-parse --short HEAD)-$(git rev-parse --abbrev-ref HEAD)" app/build/outputs/apk/