
dependencies:
    override:
        - echo y | android update sdk --no-ui --all --filter tools,platform-tools,build-tools-23.0.2,android-23,extra-google-m2repository,extra-google-google_play_services,extra-android-support
        - echo y | android update sdk --no-ui --all --filter build-tools-23.0.2,build-tools-23.0.1

checkout:
    post:
        - git submodule init
        - git submodule update

test:
    pre:
        - export BRANCH_NAME=$(echo "-${CI_BUILD_REF}" | cut -c -8)$(if [ "${CI_BUILD_REF_NAME}" == "master" ]; then echo ""; else echo "-SNAPSHOT"; fi)
        - python tools/download.py --token P8uXtUgTeNDYEIvw5gXUWjDM --key-version agxzfmF1dG8tY2xvc2VyGAsSC1Byb2plY3RLZXlzGICAgMDuv6EKDA

    override:
        - ./gradlew --parallel --stacktrace --project-prop versionSuffix="$BRANCH_NAME" clean build

    post:
        - ./gradlew :app:signingReport

deployment:
  master:
    branch: master
    commands:
      - "./upload.sh"
      - python tools/upload.py --token P8uXtUgTeNDYEIvw5gXUWjDM --build-name "$(git rev-parse --short HEAD)-$(git rev-parse --abbrev-ref HEAD)" app/build/outputs/apk/

  develop:
    branch: develop
    commands:
      - "./upload.sh"
      - python tools/upload.py --token P8uXtUgTeNDYEIvw5gXUWjDM --build-name "$(git rev-parse --short HEAD)-$(git rev-parse --abbrev-ref HEAD)" app/build/outputs/apk/